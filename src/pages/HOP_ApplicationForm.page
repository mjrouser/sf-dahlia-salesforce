<apex:page applyBodyTag="false" applyHtmlTag="false" id="HOP_ApplicationForm" controller="HOP_ApplicationFormController"
           docType="HTML-5.0" showChat="false" showHeader="false" sidebar="false" standardStylesheets="false">
    <apex:composition template="HOP_Template">
        <apex:define name="title">New Application Entry Form</apex:define>

        <apex:define name="styles">
            <link rel="stylesheet" href="{!URLFOR($Resource.HOP, '/css/jquery.datetimepicker.css')}" />
            <link rel="stylesheet" href="{!URLFOR($Resource.SalesforceDataTables, '/css/dataTables.bootstrap.min.css')}" />

            <style type="text/css">
                ul.fileList {
                    display: inline-block;
                    padding-left: 15px;
                    margin-bottom: 0;
                }
                ul.fileList li {
                    border-bottom: 1px solid #ddd;
                    padding: 5px;
                }
                ul.fileList li:last-child {
                    border-bottom: none;
                }
                .dependentPicklistWrapper select {
                    display: block;
                    width: 100%;
                    height: 34px;
                    padding: 6px 12px;
                    font-size: 14px;
                    line-height: 1.42857143;
                    color: #555;
                    background-color: #fff;
                    background-image: none;
                    border: 1px solid #ccc;
                    border-radius: 4px;
                    -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
                    box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
                    -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
                    -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
                    transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
                }
                .dependentPicklistWrapper select[disabled] {
                    background-color: #eee;
                    cursor: not-allowed;
                }
                .tt-query {
                    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
                    -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
                    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
                }
                .tt-hint {
                    color: #999
                }
                .tt-dropdown-menu {
                    width: 100%;
                    margin-top: 5px;
                    padding: 8px 0;
                    background-color: #fff;
                    border: 1px solid #ccc;
                    border: 1px solid rgba(0, 0, 0, 0.2);
                    -webkit-border-radius: 0;
                    -moz-border-radius: 0;
                    border-radius: 0;
                    -webkit-box-shadow: 0 5px 10px rgba(0,0,0,.2);
                    -moz-box-shadow: 0 5px 10px rgba(0,0,0,.2);
                    box-shadow: 0 5px 10px rgba(0,0,0,.2);
                }
                .tt-suggestion {
                    padding: 3px 20px;
                    font-size: inherit;
                    line-height: 1.5em;
                }
                .tt-suggestion.tt-cursor {
                    color: #fff;
                    background-color: #0097cf;
                }
                .tt-suggestion p {
                    margin: 0;
                    font-size: 1em;
                }
                .tt-dataset-genericDataset {
                    max-height: 200px;
                    overflow-y: auto;
                    overflow-x: hidden;
                }
                tr.selected {
                    background-color: #B0BED9 !important;
                }
                .bootbox.bootbox-confirm {
                    height: 100%;
                }
                .bootbox.bootbox-confirm .modal-dialog {
                    top: 50%;
                    transform: translateY(-50%);
                }
                p.doubleSpacing {
                    margin-bottom: 20px;
                }
                hr {
                    border-top-color: #ddd;
                }
            </style>
        </apex:define>

        <apex:define name="error">
            <div class="top-general-alert alert alert-danger slide down" role="alert" aria-hidden="true" aria-label="Page Alerts">
                <apex:messages styleClass="errorArea" id="errorMessages" />
            </div>
        </apex:define>

        <apex:define name="body">
            <apex:form styleClass="form-horizontal" rendered="{! !hasErrors }" id="myForm">
                <apex:actionFunction name="rerenderPicklists" reRender="neighborhoodPreference, dthpPreference, copPreference, liveInSfPreference, workInSfPreference" />
                <apex:actionFunction name="saveApplicationForm" action="{!saveApplicationForm}" />
                <apex:actionFunction name="saveApplicationFormAndNew" action="{!saveApplicationFormAndNew}" />
                
                <apex:outputPanel layout="block" rendered="{! !ISBLANK(retUrl) }">
                    <div class="form-group">
                        <div class="col-xs-12">
                            <a href="{!retUrl}">Back to previous page</a>
                        </div>
                    </div>
                </apex:outputPanel>
                <div class="form-group">
                    <div class="col-xs-12 sectionHeader">
                        <apex:outputPanel layout="none" rendered="{!app.Id == null}">
                            <h4>New Application</h4>
                        </apex:outputPanel>
                        <apex:outputPanel layout="none" rendered="{!app.Id != null}">
                            <h4>{! 'Application ' + appName.Name }</h4>
                        </apex:outputPanel>
                        <apex:commandButton styleClass="btn btn-primary" value="Save"
                                            onclick="checkRequiredFields_primaryApplicant(saveApplicationForm); return false;" />
                        <apex:commandButton styleClass="btn btn-primary" value="Save & New"
                                            onclick="checkRequiredFields_primaryApplicant(saveApplicationFormAndNew); return false;" />
                    </div>
                </div>
                <div style="padding-top: 15px;">
                    <h4>Name of Listing:&nbsp;<apex:outputText value="{!listingName}" /></h4>
                </div>
                <div class="section form-group-section">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Language of Application</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!app.Application_Language__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Household Annual Income</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!app.Annual_Income__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Housing Voucher / Subsidy</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!app.Housing_Voucher_or_Subsidy__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-xs-12 sectionHeader">
                        <h5>Primary Applicant Information</h5>
                    </div>
                </div>
                <div id="primaryApplicantSection" class="section form-group-section">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">First Name</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.First_Name__c}" styleClass="form-control required" onblur="rerenderPicklists()" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Middle Name</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Middle_Name__c}" styleClass="form-control" onblur="rerenderPicklists()" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Last Name</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Last_Name__c}" styleClass="form-control required" onblur="rerenderPicklists()" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Date of Birth</label>
                                <div class="col-sm-6">
                                    <div class="hidden">
                                        <apex:inputField value="{!primaryApplicant.Date_of_Birth__c}" id="dateOfBirth" />
                                    </div>
                                    <input type="text" class="form-control required" id="dateOfBirth" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-xs-12">
                            <h5>Residence Address</h5>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Street</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Street__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">City</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.City__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">State</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.State__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Zip Code</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Zip_Code__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-xs-12">
                            <h5>Mailing Address</h5>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Street</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Mailing_Street__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">City</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Mailing_City__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">State</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Mailing_State__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Zip Code</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Mailing_Zip_Code__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <div class="col-sm-6">
                                    <label class="control-label pull-left" style="margin-right: 5px;">Phone</label>
                                    <div style="overflow: hidden;">
                                        <apex:inputField value="{!primaryApplicant.Phone_Type__c}" styleClass="form-control" style="display: inline-block; width: 100%;" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Phone__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Email</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Email__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-xs-12 sectionHeader">
                        <h5>Household Members</h5>
                    </div>
                </div>

            <apex:actionRegion >
                <apex:outputPanel layout="block" styleClass="section text-center" id="householdMembersSection">
                    <div class="form-group">
                        <div class="col-xs-12">
                            <div class="section">
                                <apex:outputPanel layout="none" rendered="{!householdMembers.size == 0}">
                                    <p style="margin: 0;">No Household Members</p>
                                </apex:outputPanel>
                                <apex:outputPanel layout="none" rendered="{!householdMembers.size > 0}">
                                    <table class="table table-striped table-bordered" id="householdMembersTable">
                                        <thead>
                                            <tr>
                                                <th>First Name</th>
                                                <th>Middle Name</th>
                                                <th>Last Name</th>
                                                <th>Date of Birth</th>
                                                <th>Street</th>
                                                <th>City</th>
                                                <th>State</th>
                                                <th>Zip Code</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <apex:repeat value="{!householdMembersIndexes}" var="idx">
                                                <tr onclick="onHouseholdMemberRowClick(this, {!idx});">
                                                    <td><apex:outputField value="{!householdMembers[idx].First_Name__c}" /></td>
                                                    <td><apex:outputField value="{!householdMembers[idx].Middle_Name__c}" /></td>
                                                    <td><apex:outputField value="{!householdMembers[idx].Last_Name__c}" /></td>
                                                    <td><apex:outputField value="{!householdMembers[idx].Date_of_Birth__c}" /></td>
                                                    <td><apex:outputField value="{!householdMembers[idx].Street__c}" /></td>
                                                    <td><apex:outputField value="{!householdMembers[idx].City__c}" /></td>
                                                    <td><apex:outputField value="{!householdMembers[idx].State__c}" /></td>
                                                    <td><apex:outputField value="{!householdMembers[idx].Zip_Code__c}" /></td>
                                                </tr>
                                            </apex:repeat>
                                        </tbody>
                                    </table>
                                </apex:outputPanel>
                            </div>
                        </div>
                    </div>

                    <apex:inputHidden id="selectedHouseholdMemberIdx" value="{!selectedHouseholdMemberIdx}" />

                    <apex:commandButton styleClass="btn btn-primary" value="New"
                                        rendered="{!currentHouseholdMember == null}"
                                        action="{!newHouseholdMember}" reRender="householdMembersSection, errorMessages"
                                        oncomplete="afterNewHouseholdMemberClick()" />
                    <apex:commandButton styleClass="btn btn-primary" value="Edit"
                                        rendered="{!currentHouseholdMember == null && householdMembers.size > 0}"
                                        action="{!editHouseholdMember}" reRender="householdMembersSection, errorMessages"
                                        oncomplete="afterEditHouseholdMemberClick()"
                                        id="householdMemberEdit" />
                    <apex:commandButton styleClass="btn btn-primary" value="Delete"
                                        onclick="beforeDeleteHouseholdMember(); return false;"
                                        rendered="{!currentHouseholdMember == null && householdMembers.size > 0}"
                                        id="householdMemberDelete" />

                    <apex:outputPanel layout="none" rendered="{!currentHouseholdMember != null}">
                        <div id="householdMemberSection">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="col-sm-6 control-label">First Name</label>
                                        <div class="col-sm-6">
                                            <apex:inputField value="{!currentHouseholdMember.First_Name__c}" styleClass="form-control required"
                                                             id="householdMemberFirstName" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="col-sm-6 control-label">Middle Name</label>
                                        <div class="col-sm-6">
                                            <apex:inputField value="{!currentHouseholdMember.Middle_Name__c}" styleClass="form-control" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="col-sm-6 control-label">Last Name</label>
                                        <div class="col-sm-6">
                                            <apex:inputField value="{!currentHouseholdMember.Last_Name__c}" styleClass="form-control required" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="col-sm-6 control-label">Date of Birth</label>
                                        <div class="col-sm-6">
                                            <div class="hidden">
                                                <apex:inputField value="{!currentHouseholdMember.Date_of_Birth__c}" id="dateOfBirth_chm" />
                                            </div>
                                            <input type="text" class="form-control required" id="dateOfBirth_chm" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="col-sm-6 control-label">Street</label>
                                        <div class="col-sm-6">
                                            <apex:inputField value="{!currentHouseholdMember.Street__c}" styleClass="form-control" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="col-sm-6 control-label">City</label>
                                        <div class="col-sm-6">
                                            <apex:inputField value="{!currentHouseholdMember.City__c}" styleClass="form-control" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="col-sm-6 control-label">State</label>
                                        <div class="col-sm-6">
                                            <apex:inputField value="{!currentHouseholdMember.State__c}" styleClass="form-control" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="col-sm-6 control-label">Zip Code</label>
                                        <div class="col-sm-6">
                                            <apex:inputField value="{!currentHouseholdMember.Zip_Code__c}" styleClass="form-control" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </apex:outputPanel>

                    <apex:actionFunction name="addHouseholdMember" action="{!addHouseholdMember}"
                                         reRender="householdMembersSection, specialProgramPreferencesSection, errorMessages"
                                         oncomplete="afterAddHouseholdMemberClick()" />
                    <apex:actionFunction name="addHouseholdMemberAndNew" action="{!addHouseholdMemberAndNew}"
                                         reRender="householdMembersSection, specialProgramPreferencesSection, errorMessages"
                                         oncomplete="afterAddHouseholdMemberAndNewClick()" />
                    <apex:actionFunction name="saveHouseholdMember" action="{!saveHouseholdMember}"
                                         reRender="householdMembersSection, specialProgramPreferencesSection, errorMessages"
                                         oncomplete="cancelHouseholdMember()" />
                    <apex:actionFunction name="cancelHouseholdMember" action="{!cancelHouseholdMember}"
                                         reRender="householdMembersSection, errorMessages" immediate="true"
                                         oncomplete="afterCancelHouseholdMemberClick()" />
                    <apex:actionFunction name="deleteHouseholdMember" action="{!deleteHouseholdMember}"
                                         reRender="householdMembersSection, errorMessages"
                                         oncomplete="afterDeleteHouseholdMember()" />

                    <!--
                    <apex:commandButton styleClass="btn btn-primary" value="Add"
                                        rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx == -1}"
                                        onclick="checkRequiredFields_householdMember(addHouseholdMember); return false;" />
                    <apex:commandButton styleClass="btn btn-primary" value="Add & New"
                                        rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx == -1}"
                                        onclick="checkRequiredFields_householdMember(addHouseholdMemberAndNew); return false;" />
                    <apex:commandButton styleClass="btn btn-primary" value="Save"
                                        rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx != -1}"
                                        onclick="checkRequiredFields_householdMember(saveHouseholdMember); return false;" />
                    <apex:commandButton styleClass="btn btn-primary" value="Cancel"
                                        rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx != -1}"
                                        onclick="cancelHouseholdMember(); return false;" />
                    -->

                    <apex:outputPanel layout="none" rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx == -1}">
                        <button type="button" class="btn btn-primary" onclick="checkRequiredFields_householdMember(addHouseholdMember);">Add</button>
                    </apex:outputPanel>
                    <apex:outputPanel layout="none" rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx == -1}">
                        <button type="button" class="btn btn-primary" onclick="checkRequiredFields_householdMember(addHouseholdMemberAndNew);">Add &amp; New</button>
                    </apex:outputPanel>
                    <apex:outputPanel layout="none" rendered="{!currentHouseholdMember != null && selectedHouseholdMemberIdx != -1}">
                        <button type="button" class="btn btn-primary" onclick="checkRequiredFields_householdMember(saveHouseholdMember);">Save</button>
                    </apex:outputPanel>
                    <apex:outputPanel layout="none" rendered="{!currentHouseholdMember != null}">
                        <button type="button" class="btn btn-primary" onclick="cancelHouseholdMember();">Cancel</button>
                    </apex:outputPanel>
                </apex:outputPanel>
            </apex:actionRegion>

                <div class="form-group">
                    <div class="col-xs-12 sectionHeader">
                        <h5>Special Program Preferences</h5>
                    </div>
                </div>
                <apex:outputPanel layout="block" styleClass="section form-group-section" id="specialProgramPreferencesSection">
                    <p class="doubleSpacing">Please check to make sure that a document proving the preference address was attached to the application. If no proof document was attached, do not enter anything below.</p>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Which HH member name is on the Live in SF proof?</label>
                                <div class="col-sm-6">
                                    <apex:selectList id="liveInSfPreference" value="{!liveInSfPreference}" size="1" styleClass="form-control">
                                        <apex:selectOptions value="{!householdMembersSO}"/>
                                    </apex:selectList>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Which HH member name is on the Work in SF proof?</label>
                                <div class="col-sm-6">
                                    <apex:selectList id="workInSfPreference" value="{!workInSfPreference}" size="1" styleClass="form-control">
                                        <apex:selectOptions value="{!householdMembersSO}"/>
                                    </apex:selectList>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Which HH member name is on the Neighborhood proof?</label>
                                <div class="col-sm-6">
                                    <apex:selectList id="neighborhoodPreference" value="{!neighborhoodPreference}" size="1" styleClass="form-control">
                                        <apex:selectOptions value="{!householdMembersSO}"/>
                                    </apex:selectList>
                                </div>
                            </div>
                            <p><em>If the person selected above is not the primary applicant, you must enter their residence address in the Household Members table above. MOHCD will verify that their address qualifies for NHRP.</em></p>
                        </div>
                    </div>
                    <hr />
                    <p class="doubleSpacing">For the following preferences, MOHCD will verify that the applicant holds a valid certificate. No proof is required.</p>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Name of DTHP certificate holder</label>
                                <div class="col-sm-6">
                                    <apex:selectList id="dthpPreference" value="{!dthpPreference}" size="1" styleClass="form-control">
                                        <apex:selectOptions value="{!householdMembersSO}"/>
                                    </apex:selectList>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Name of COP holder</label>
                                <div class="col-sm-6">
                                    <apex:selectList id="copPreference" value="{!copPreference}" size="1" styleClass="form-control">
                                        <apex:selectOptions value="{!householdMembersSO}"/>
                                    </apex:selectList>
                                </div>
                            </div>
                        </div>
                    </div>
                </apex:outputPanel>
                <div class="form-group">
                    <div class="col-xs-12 sectionHeader">
                        <h5>Demographic Information</h5>
                    </div>
                </div>
                <div class="section form-group-section">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Gender</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Gender__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Sexual Orientation</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Sexual_Orientation__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Gender Specify (If Not Listed)</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Gender_Other__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Orientation Specify (If Not Listed)</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Sexual_Orientation_Other__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Ethnicity</label>
                                <div class="col-sm-6">
                                    <apex:inputField value="{!primaryApplicant.Ethnicity__c}" styleClass="form-control" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-6 control-label">Race</label>
                                <div class="col-sm-6">
                                    <div class="dependentPicklistWrapper">
                                        <apex:inputField value="{!primaryApplicant.Race__c}" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xs-12">
                    <div class="form-inline">
                        <div class="form-group" style="padding: 10px 0;">
                            <label>Signature on Terms of Agreement&ensp;</label>
                            <div class="checkbox">
                                <label>
                                    <apex:inputField value="{!app.Terms_Acknowledged__c}" styleClass="form-control" />
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-xs-12 sectionHeader">
                        <apex:commandButton styleClass="btn btn-primary" value="Save"
                                            onclick="checkRequiredFields_primaryApplicant(saveApplicationForm); return false;" />
                        <apex:commandButton styleClass="btn btn-primary" value="Save & New"
                                            onclick="checkRequiredFields_primaryApplicant(saveApplicationFormAndNew); return false;" />
                    </div>
                </div>
            </apex:form>
        </apex:define>

        <apex:define name="scripts">
            <script src="{!URLFOR($Resource.HOP, '/js/moment.min.js')}"></script>
            <script src="{!URLFOR($Resource.HOP, '/js/jquery.datetimepicker.js')}"></script>
            <script src="{!URLFOR($Resource.HOP, '/js/typeahead.bundle.min.js')}"></script>
            <script src="{!URLFOR($Resource.HOP, '/js/bootbox.min.js')}"></script>
            <script src="{!URLFOR($Resource.SalesforceDataTables, '/js/jquery.dataTables.min.js')}"></script>
            <script src="{!URLFOR($Resource.SalesforceDataTables, '/js/dataTables.bootstrap.min.js')}"></script>

            <script>
                Date.parseDate = function(input, format) {
                    return moment(input,format).toDate();
                };
                Date.prototype.dateFormat = function(format) {
                    return moment(this).format(format);
                };

                function addPageError(html) {
                    document.getElementById('responseErrors').innerHTML =
                        '<button type="button" class="close" aria-label="Close" onclick="document.getElementById(\'responseErrors\').innerHTML = \'\';">' +
                            '<span aria-hidden="true">&times;</span>' +
                        '</button>' + html;
                }
                
                function checkRequiredFields(wrapperId, postCheckRun) {
                    var toFocus;
                    $('#' + wrapperId + ' .required').each(function() {
                        var $e = $(this);
                        if (!$e.val()) {
                            $e.addClass('input-error');
                            (function($e) {
                                window.setTimeout( function() { $e.removeClass('input-error'); }, 1000 );
                            })($e);
                            if (!toFocus) toFocus = $e;
                        }
                    });
                    if (toFocus) {
                        toFocus.focus();
                    } else {
                        postCheckRun();
                    }
                }

                function checkRequiredFields_primaryApplicant(postCheckRun) {
                    checkRequiredFields('primaryApplicantSection', postCheckRun);
                }

                function checkRequiredFields_householdMember(postCheckRun) {
                    console.log(postCheckRun);
                    checkRequiredFields('householdMemberSection', postCheckRun);
                }

                /*
                function remotingErrorHandler(event) {
                    if (event.status) {
                        return true;
                    } else if (event.type === 'exception') {
                        console.log(event);
                        addPageError('Exception: ' + event.message + '<br/>\nMethod: ' + event.method + '<br/>\nStack trace: ' + event.where);
                    } else {
                        console.log(event);
                        addPageError('Error (type ' + (event.type || 'none') + '): ' + event.message);
                    }
                    return false;
                }
                */

                function onHouseholdMemberRowClick(row, idx) {
                    var $row = $(row);
                    var $editButton = $('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberEdit');
                    var $deleteButton = $('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberDelete');

                    if ($row.hasClass('selected')) {
                        $row.removeClass('selected');
                        $editButton.prop('disabled', true);
                        $deleteButton.prop('disabled', true);
                        $('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:selectedHouseholdMemberIdx').val(-1);
                    } else {
                        var $tbody = $row.parent();
                        $tbody.children('tr.selected').removeClass('selected');
                        $row.addClass('selected');
                        $editButton.prop('disabled', false);
                        $deleteButton.prop('disabled', false);
                        $('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:selectedHouseholdMemberIdx').val(idx);
                    }
                }

                function afterNewHouseholdMemberClick() {
                    rebuildDateTimePicker('dateOfBirth_chm');
                    rebuildDataTable();
                    $('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberFirstName').focus();
                }

                function afterEditHouseholdMemberClick() {
                    rebuildDateTimePicker('dateOfBirth_chm');
                    $('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberFirstName').focus();
                }

                function afterAddHouseholdMemberClick() {
                    rebuildDataTable();
                }

                function afterAddHouseholdMemberAndNewClick() {
                    rebuildDateTimePicker('dateOfBirth_chm');
                    rebuildDataTable();
                    $('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:householdMemberFirstName').focus();
                }

                function afterSaveMemberClick() {
                    rebuildDataTable();
                }

                function afterCancelHouseholdMemberClick() {
                    rebuildDataTable();
                }

                function beforeDeleteHouseholdMember() {
                    bootbox.confirm({ 
                        size: 'small',
                        closeButton: false,
                        message: 'Are you sure you want to delete this member?', 
                        callback: function(result) {
                            if (result) deleteHouseholdMember();
                        }
                    });
                }

                function afterDeleteHouseholdMember() {
                    rebuildDataTable();
                }
    
                function rebuildDateTimePicker(id) {
                    var $elem = $('#' + id);
                    var $VFelem = $('#HOP_ApplicationForm\\:HOP_Template\\:myForm\\:' + id);
                    var val = $VFelem.val();
                    $elem.datetimepicker({
                        timepicker: false,
                        scrollMonth: false,
                        format: 'M/D/YYYY',
                        formatDate: 'M/D/YYYY',
                        closeOnDateSelect: true,
                        value: val || null,
                        onChangeDateTime: function() {
                            $VFelem.val($elem.val());
                        }
                    });
                }

                function rebuildDataTable() {
                    $('#householdMembersTable').DataTable({
                        'paging': true,
                        'ordering': true,
                        'info': true,
                        'searching': true
                    });
                }

                $(document).ready(function() {
                    rebuildDateTimePicker('dateOfBirth');
                    if ({!householdMembers.size > 0}) {
                        rebuildDataTable();
                    }
                });
            </script>
        </apex:define>
    </apex:composition>
</apex:page>